lists
lists <- grepl("*Brand.txt", files)
grepl("Summary", lists)
grepl("*Brand.txt", files)
grepl("Summary", lists)
files  <- paste0(dir,"/",list.files(dir))
lists <- grepl("*Brand.txt", files)
grepl("Summary", lists)
lists
lists <- grep("*Brand.txt", files, value = T)
grepl("Summary", lists)
("Summary" %in% lists)
( lists %in% "Summary")
(lists %in% "Summary")
grep("[^Summary]*Brand.txt", files, value = T)
summary <- list()
grep("[^Summary]*+Brand.txt", files, value = T)
grep("[^Summary].+Brand.txt", files, value = T)
grep("[^Summary].+", files, value = T)
grep(".+[^Summary].+Brand.txt", files, value = T)
grep(".+/[^Summary].+Brand.txt", files, value = T)
grep("[^~/GetBrandNames/Summary].+Brand.txt", files, value = T)
grep("^~/GetBrandNames/Summary.+Brand.txt", files, value = T)
lists <- grep("*Brand.txt", files, value = T)
lists <- lists[!grepl("Summary", lists)]
lists
lists <- lists[!grepl("Summary", lists)]
summary <- list()
for (list in lists){
temp_list <- as_data_frame(read.csv(list, header = T, stringsAsFactors = F))
temp_list <- temp_list %>%
select(drug = contains("drug"), brand = contains("brand")) %>%
mutate(source = list)
for(i in 1:nrow(temp_list)){
drug <- temp_list[i,"drug", drop = T]
if (nchar(temp_list[i,"brand"])){
brand <- as.data.frame(temp_list[i,"brand"])
names(brand) <- "Brand"
summary[[drug]]["Brand"] <- rbind(summary[[drug]]["Brand"],
brand
)
}
source <- as.data.frame(temp_list[i,"source"])
names(source) <- "Source"
summary[[drug]]["Source"] <- rbind(summary[[drug]]["Source"],
source
)
}
}
summary
summary <- list()
for (list in lists){
temp_list <- as_data_frame(read.csv(list, header = T, stringsAsFactors = F))
temp_list <- temp_list %>%
select(drug = contains("drug"), brand = contains("brand")) %>%
mutate(source = list)
for(i in 1:nrow(temp_list)){
drug <- temp_list[i,"drug", drop = T]
if (nchar(temp_list[i,"brand"])){
brand <- as.data.frame(temp_list[i,"brand"])
names(brand) <- "Brand"
summary[[drug]]["Brand"] <- rbind(summary[[drug]]["Brand"],
brand
)
}
}
}
summary
summary <- list()
for (list in lists){
temp_list <- as_data_frame(read.csv(list, header = T, stringsAsFactors = F))
temp_list <- temp_list %>%
select(drug = contains("drug"), brand = contains("brand")) %>%
mutate(source = list)
for(i in 1:nrow(temp_list)){
drug <- temp_list[i,"drug", drop = T]
if (nchar(temp_list[i,"brand"])){
brand <- as.data.frame(temp_list[i,"brand"])
names(brand) <- "Brand"
summary[[drug]]["Brand"] <- rbind(summary[[drug]]["Brand"],
brand
)
}else{
summary[[drug]]["Brand"] <- ""
}
}
}
summary
write(paste0("drug",",","brand_summary"), file = outfile, append = T)
for (drug in names(summary)){
uniq_brand <- unique(summary[[drug]]["Brand"])
out <- paste(drug,uniq_brand,sep = ",")
write(out, file = outfile, append = T)
}
write(paste0("drug",",","brand_summary"), file = outfile, append = T)
for (drug in names(summary)){
uniq_brand <- unique(summary[[drug]]["Brand"])
out <- paste(drug,paste(uniq_brand,collapse = ","),sep = ",")
write(out, file = outfile, append = T)
}
paste(uniq_brand,collapse = ",")
summary
date <- format(Sys.time(), "%b_%d_%Y")
outfile <- paste0("~/GetBrandNames/", "Summary_" , date , "_Brand.txt") # output filename
if (file.exists(outfile)){
file.remove(outfile)
}
write(paste0("drug",",","brand_summary"), file = outfile, append = T)
for (drug in names(summary)){
uniq_brand <- unique(summary[[drug]]["Brand"])
out <- paste(drug,paste(uniq_brand,collapse = ","),sep = ",")
write(out, file = outfile, append = T)
}
paste(uniq_brand,collapse = ",")
junk <- c("A","B")
paste(junk,collapse = ",")
date <- format(Sys.time(), "%b_%d_%Y")
outfile <- paste0("~/GetBrandNames/", "Summary_" , date , "_Brand.txt") # output filename
if (file.exists(outfile)){
file.remove(outfile)
}
if (file.exists(outfile)){
file.remove(outfile)
}
write(paste0("drug",",","brand_summary"), file = outfile, append = T)
for (drug in names(summary)){
uniq_brand <- unique(summary[[drug]]["Brand"])
out <- paste(drug,paste(uniq_brand,collapse = ","),sep = ",")
write(out, file = outfile, append = T)
}
junk <- c("A","B")
paste(junk,collapse = ",")
for (drug in names(summary)){
uniq_brand <- unique(summary[[drug]]["Brand"])
for (brand in uniq_brand){
out <- paste(drug, brand, sep = ",")
write(out, file = outfile, append = T)
}
}
date <- format(Sys.time(), "%b_%d_%Y")
outfile <- paste0("~/GetBrandNames/", "Summary_" , date , "_Brand.txt") # output filename
if (file.exists(outfile)){
file.remove(outfile)
}
write(paste0("drug",",","brand_summary"), file = outfile, append = T)
for (drug in names(summary)){
uniq_brand <- unique(summary[[drug]]["Brand"])
for (brand in uniq_brand){
out <- paste(drug, brand, sep = ",")
write(out, file = outfile, append = T)
}
}
unique(summary[[drug]]["Brand"])
for (drug in names(summary)){
uniq_brand <- unique(summary[[drug]]["Brand"])
for (brand in uniq_brand){
out <- paste(drug, brand, sep = ",")
write(out, file = outfile, append = T)
}
}
summary$methotrexate$Brand
unique(summary$methotrexate$Brand)
date <- format(Sys.time(), "%b_%d_%Y")
outfile <- paste0("~/GetBrandNames/", "Summary_" , date , "_Brand.txt") # output filename
if (file.exists(outfile)){
file.remove(outfile)
}
write(paste0("drug",",","brand_summary"), file = outfile, append = T)
for (drug in names(summary)){
uniq_brand <- unique(summary[[drug]]["Brand"])
for (brand in uniq_brand){
out <- paste(drug, brand, sep = ",")
write(out, file = outfile, append = T)
}
}
for (drug in names(summary)){
uniq_brand <- unique(summary[[drug]]["Brand"])
print(unq_brand)
for (brand in uniq_brand){
out <- paste(drug, brand, sep = ",")
write(out, file = outfile, append = T)
}
}
for (drug in names(summary)){
uniq_brand <- unique(summary[[drug]]["Brand"])
print(uniq_brand)
for (brand in uniq_brand){
out <- paste(drug, brand, sep = ",")
write(out, file = outfile, append = T)
}
}
summary[[drug]]["Brand"]
for (drug in names(summary)){
brands <- (summary[[drug]]["Brand"])
uniq <- unique(brands)
print(uniq_brand)
for (brand in uniq_brand){
out <- paste(drug, brand, sep = ",")
write(out, file = outfile, append = T)
}
}
date <- format(Sys.time(), "%b_%d_%Y")
outfile <- paste0("~/GetBrandNames/", "Summary_" , date , "_Brand.txt") # output filename
if (file.exists(outfile)){
file.remove(outfile)
}
write(paste0("drug",",","brand_summary"), file = outfile, append = T)
for (drug in names(summary)){
brands <- (summary[[drug]]["Brand"])
uniq <- unique(brands)
print(uniq_brand)
for (brand in uniq_brand){
out <- paste(drug, brand, sep = ",")
write(out, file = outfile, append = T)
}
}
for (drug in names(summary)){
brands <- summary[[drug]]["Brand"]
uniq <- unique(brands)
print(uniq_brand)
for (brand in uniq_brand){
out <- paste(drug, brand, sep = ",")
write(out, file = outfile, append = T)
}
}
for (drug in names(summary)){
brands <- summary[[drug]]["Brand"]
uniq_brand <- unique(brands)
print(uniq_brand)
for (brand in uniq_brand){
out <- paste(drug, brand, sep = ",")
write(out, file = outfile, append = T)
}
}
print(str(brands))
write(paste0("drug",",","brand_summary"), file = outfile, append = T)
for (drug in names(summary)){
brands <- summary[[drug]]["Brand"]
print(str(brands))
uniq_brand <- unique(brands)
print(uniq_brand)
for (brand in uniq_brand){
out <- paste(drug, brand, sep = ",")
write(out, file = outfile, append = T)
}
}
for (drug in names(summary)){
brands <- summary[[drug]]["Brand"]
print(str(brands))
uniq_brand <- unique(unlist(brands))
print(uniq_brand)
for (brand in uniq_brand){
out <- paste(drug, brand, sep = ",")
write(out, file = outfile, append = T)
}
}
for (drug in names(summary)){
uniq_brand <- unique(unlist(summary[[drug]]["Brand"]))
print(uniq_brand)
for (brand in uniq_brand){
out <- paste(drug, brand, sep = ",")
write(out, file = outfile, append = T)
}
}
lc(junk)
junk <- c("A","B")
lc(junk)
tolower(junk)
dir    <- "~/GetBrandNames"
files  <- paste0(dir,"/",list.files(dir))
lists <- grep("*Brand.txt", files, value = T)
lists <- lists[!grepl("Summary", lists)]
summary <- list()
for (list in lists){
temp_list <- as_data_frame(read.csv(list, header = T, stringsAsFactors = F))
temp_list <- temp_list %>%
select(drug = contains("drug"), brand = contains("brand")) %>%
mutate(source = list)
for(i in 1:nrow(temp_list)){
drug <- tolower(temp_list[i,"drug", drop = T])
if (nchar(temp_list[i,"brand"])){
brand <- as.data.frame(temp_list[i,"brand"])
names(brand) <- "Brand"
summary[[drug]]["Brand"] <- rbind(summary[[drug]]["Brand"],
brand
)
}else{
summary[[drug]]["Brand"] <- ""
}
}
}
summary
date <- format(Sys.time(), "%b_%d_%Y")
outfile <- paste0("~/GetBrandNames/", "Summary_" , date , "_Brand.txt") # output filename
if (file.exists(outfile)){
file.remove(outfile)
}
write(paste0("drug",",","brand_summary"), file = outfile, append = T)
for (drug in names(summary)){
uniq_brand <- unique(unlist(summary[[drug]]["Brand"]))
print(uniq_brand)
for (brand in uniq_brand){
out <- paste(drug, brand, sep = ",")
write(out, file = outfile, append = T)
}
}
junk <- c("A","B")
paste(junk,collapse = ",")
#!/usr/bin/env Rscript
#------
# File   : brand_by_scrapping.R
# History: 25-Jan-2019 Zhaozhi created the file
#------
# This file take the <drug list> and get the brand name from <DrugBank>
# Input  : ~/Desktop/drug.list.txt
# Output : ~/Desktop/Scraping_date.brand.txt
#------
#------
# Workflow and Argument
#------
# Step 1: get druglist
#         Line 38 to change druglist file name
# Step 2: get drugbank external links
#         Line 42~ to change drugbank username and password
# Step 3: scrapping and get brand name
# Step 4: write result to outfile
#         Line 55 to change output file name
#-------
# install and load packages
required_packages=c("tidyverse");
Install_And_Load <- function(required_packages){
remaining_packages <- required_packages[!(required_packages %in% installed.packages()[,"Package"])];
if(length(remaining_packages)){
install.packages(remaining_packages);
}
for(package in required_packages){
library(package, character.only = TRUE,quietly = TRUE);
}
}
Install_And_Load(required_packages);
dir    <- "~/GetBrandNames"
files  <- paste0(dir,"/",list.files(dir))
lists <- grep("*Brand.txt", files, value = T)
lists <- lists[!grepl("Summary", lists)]
summary <- list()
for (list in lists){
temp_list <- as_data_frame(read.csv(list, header = T, stringsAsFactors = F))
temp_list <- temp_list %>%
select(drug = contains("drug"), brand = contains("brand")) %>%
mutate(source = list)
for(i in 1:nrow(temp_list)){
drug <- tolower(temp_list[i,"drug", drop = T])
if (nchar(temp_list[i,"brand"])){
brand <- as.data.frame(temp_list[i,"brand"])
names(brand) <- "Brand"
summary[[drug]]["Brand"] <- rbind(summary[[drug]]["Brand"],
brand
)
}else{
summary[[drug]]["Brand"] <- ""
}
}
}
date <- format(Sys.time(), "%b_%d_%Y")
outfile <- paste0("~/Desktop/", "Summary_" , date , "_Brand.txt") # output filename
if (file.exists(outfile)){
file.remove(outfile)
}
write(paste0("drug",",","brand_summary"), file = outfile, append = T)
for (drug in names(summary)){
uniq_brand <- unique(unlist(summary[[drug]]["Brand"]))
print(uniq_brand)
for (brand in uniq_brand){
out <- paste(drug, brand, sep = ",")
write(out, file = outfile, append = T)
}
}
#------
# Workflow and Argument
#------
# Step 1: build local MySQL database
#         (a) create a local MySQL database
#             Line 52 to change database name
#         (b) download dump files from ChEBI (They actually provide .sql files)
#             Line 87 and 93 to change dump files url
#         (c) import data from dump diles to new database
# Step 2: get query data
drug_list <- readLines("~/Desktop/druglist.txt")
#         Line 122 to change query
# Step 3: write result to outfile
#         Line 117 to change output file name
# Step 4: whether delete this database
delete_database  <- FALSE
# install and load packages
required_packages=c("RMySQL","dbConnect");
Install_And_Load <- function(required_packages){
remaining_packages <- required_packages[!(required_packages %in% installed.packages()[,"Package"])];
if(length(remaining_packages)){
install.packages(remaining_packages);
}
for(package in required_packages){
library(package, character.only = TRUE,quietly = TRUE);
}
}
Install_And_Load(required_packages);
# connect to SQL
con <- dbConnect(
MySQL(),
dbname   = '',
user     = 'root',
password = 'yw8570lucky'                                 # database password
)
dbSendQuery(con, paste0("use ", dbname, ";"))
date    <- format(Sys.time(), "%b_%d_%Y_")
outfile <- paste0("~/Desktop/", "MySQL_", date, "Brand.txt")     # outfile name
# get brand names
query     <- ""
for (i in 1:length(drug_list)) {
# MySQL Qeury
query   <- paste0(
query,
"SELECT names.name AS brand_name, compounds.chebi_accession, compounds.name AS drug_compounds_name",
" FROM names",
" JOIN compounds",
" ON compounds.id = names.compound_id",
" WHERE names.type = 'BRAND NAME' AND compounds.name = '", drug_list[i], "'"
)
if(i != length(drug_list)){
query   <- paste0(query, " union ")
}else{
query   <- paste0(query, ";")
}
}
result  <- dbGetQuery(con, query)                     # Retrive result
write.table(result, file = outfile, row.names=FALSE, sep = ",")
dbDisconnect(con)
#!/usr/bin/env Rscript
#------
# File   : brand_by_scrapping.R
# History: 25-Jan-2019 Zhaozhi created the file
#------
# This file take the <drug list> and get the brand name from <DrugBank>
# Input  : ~/Desktop/drug.list.txt
# Output : ~/Desktop/Scraping_date.brand.txt
#------
#------
# Workflow and Argument
#------
# Step 1: get druglist
#         Line 38 to change druglist file name
# Step 2: get drugbank external links
#         Line 44 and 45 to change drugbank username and password
# Step 3: scrapping and get brand name
# Step 4: write result to outfile
#         Line 55 to change output file name
#-------
# install and load packages
required_packages=c("tidyverse","rvest");
Install_And_Load <- function(required_packages){
remaining_packages <- required_packages[!(required_packages %in% installed.packages()[,"Package"])];
if(length(remaining_packages)){
install.packages(remaining_packages);
}
for(package in required_packages){
library(package, character.only = TRUE,quietly = TRUE);
}
}
Install_And_Load(required_packages);
# get druglist
drug.list <- readLines("~/Desktop/druglist.txt")
# get drugbank links
temp_dir   <- tempfile()
temp_file  <- tempfile()                                          # create temp file and dir to load data
download_db_link <- paste0(
"curl -Lfv -o ", temp_file,                                     # filename
" -u ", "username",                                             # drugbank username
":", "password",                                                # password
" ","https://www.drugbank.ca/releases/5-1-2/downloads/all-drug-links"
)
system(download_db_link)
unzip(temp_file, exdir = temp_dir)                                # unzip temp file in temp dir
files     <- paste0(temp_dir,"/",list.files(temp_dir))
drug.bank <- read.csv(files)
unlink(c(temp_file,temp_dir))
date <- format(Sys.time(), "%b_%d_%Y")
outfile <- paste0("~/GetBrandNames/", "Scraping_" , date , "_Brand.txt") # output filename
if (file.exists(outfile)){
file.remove(outfile)
}
write(paste0("drug",",","brand"), file = outfile, append = T)
# Scrapping
for (drug in drug.list) {
# is drug exits in brugbank
if (drug %in% drug.bank$Name){
# get drug.com url
url <- as.character(drug.bank[drug.bank$Name == drug,"Drugs.com.Link"])
# get brand names
brand_name <- (read_html(url) %>%
html_nodes("p.drug-subtitle") %>%
html_text() %>%
strsplit("Brand Name: ")
)[[1]][-1]
# write output
out <- paste(drug,brand_name,sep = ",")
write(out, file = outfile, append = T)
}else{
# print message about missing drugs
print(paste("Can't find DrugBank ID for", drug, sep = " "))
out <- paste(drug,"",sep = ",")
write(out, file = outfile, append = T)
}
}
