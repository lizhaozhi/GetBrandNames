summary[[drug]]["Brand"] <- rbind(summary[[drug]]["Brand"],
brand
)
}
source <- as.data.frame(temp_list[i,"brand"])
names(source) <- "Source"
summary[[drug]]["Source"] <- rbind(summary[[drug]]["Source"],
source
)
}
}
summary
names(summary)
date <- format(Sys.time(), "%b_%d_%Y")
outfile <- paste0("~/GetBrandNames/", "Summary_" , date , "_Brand.txt") # output filename
if (file.exists(outfile)){
file.remove(outfile)
}
write(paste0("drug",",","brand"), file = outfile, append = T)
source <- as.data.frame(temp_list[i,"source"])
source
for (list in lists){
temp_list <- as_data_frame(read.csv(list, header = T, stringsAsFactors = F))
temp_list <- temp_list %>%
select(drug = contains("drug"), brand = contains("brand")) %>%
mutate(source = list)
for(i in 1:nrow(temp_list)){
drug <- temp_list[i,"drug", drop = T]
if (nchar(temp_list[i,"brand"])){
brand <- as.data.frame(temp_list[i,"brand"])
names(brand) <- "Brand"
summary[[drug]]["Brand"] <- rbind(summary[[drug]]["Brand"],
brand
)
}
source <- as.data.frame(temp_list[i,"source"])
names(source) <- "Source"
summary[[drug]]["Source"] <- rbind(summary[[drug]]["Source"],
source
)
}
}
summary
dir    <- "~/GetBrandNames"
files  <- paste0(dir,"/",list.files(dir))
lists <- grep("*Brand.txt", files, value = T)
summary <- list()
for (list in lists){
temp_list <- as_data_frame(read.csv(list, header = T, stringsAsFactors = F))
temp_list <- temp_list %>%
select(drug = contains("drug"), brand = contains("brand")) %>%
mutate(source = list)
for(i in 1:nrow(temp_list)){
drug <- temp_list[i,"drug", drop = T]
if (nchar(temp_list[i,"brand"])){
brand <- as.data.frame(temp_list[i,"brand"])
names(brand) <- "Brand"
summary[[drug]]["Brand"] <- rbind(summary[[drug]]["Brand"],
brand
)
}
source <- as.data.frame(temp_list[i,"source"])
names(source) <- "Source"
summary[[drug]]["Source"] <- rbind(summary[[drug]]["Source"],
source
)
}
}
dir    <- "~/GetBrandNames"
files  <- paste0(dir,"/",list.files(dir))
lists <- grep("*Brand.txt", files, value = T)
summary <- list()
for (list in lists){
temp_list <- as_data_frame(read.csv(list, header = T, stringsAsFactors = F))
temp_list <- temp_list %>%
select(drug = contains("drug"), brand = contains("brand")) %>%
mutate(source = list)
for(i in 1:nrow(temp_list)){
drug <- temp_list[i,"drug", drop = T]
if (nchar(temp_list[i,"brand"])){
brand <- as.data.frame(temp_list[i,"brand"])
names(brand) <- "Brand"
summary[[drug]]["Brand"] <- rbind(summary[[drug]]["Brand"],
brand
)
}
source <- as.data.frame(temp_list[i,"source"])
names(source) <- "Source"
summary[[drug]]["Source"] <- rbind(summary[[drug]]["Source"],
source
)
}
}
drug
dir    <- "~/GetBrandNames"
files  <- paste0(dir,"/",list.files(dir))
lists <- grep("*Brand.txt", files, value = T)
summary <- list()
list in lists
temp_list <- as_data_frame(read.csv(list, header = T, stringsAsFactors = F))
temp_list <- temp_list %>%
select(drug = contains("drug"), brand = contains("brand")) %>%
mutate(source = list)
for(i in 1:nrow(temp_list)){
drug <- temp_list[i,"drug", drop = T]
if (nchar(temp_list[i,"brand"])){
brand <- as.data.frame(temp_list[i,"brand"])
names(brand) <- "Brand"
summary[[drug]]["Brand"] <- rbind(summary[[drug]]["Brand"],
brand
)
}
source <- as.data.frame(temp_list[i,"source"])
names(source) <- "Source"
summary[[drug]]["Source"] <- rbind(summary[[drug]]["Source"],
source
)
}
drug
temp_list
lists <- grep("[^Summary]*Brand.txt", files, value = T)
lists
lists <- grep("[Summary]*Brand.txt", files, value = T)
lists
lists <- grep("[Summary_]*_Brand.txt", files, value = T)
lists <- grep("[^Summary_]*_Brand.txt", files, value = T)
lists
lists <- contains("Summary", lists)
lists <- lists %>% select(!contains("Summary"))
lists <- lists %>% !contains("Summary")
"Summary" %in% lists
grep("Summary", lists)
grepl("Summary", lists)
lists <- grepl("Summary*Brand.txt", files, value = T)
lists <- grepl("Summary*Brand.txt", files)
lists
lists <- grepl("*Brand.txt", files)
grepl("Summary", lists)
grepl("*Brand.txt", files)
grepl("Summary", lists)
files  <- paste0(dir,"/",list.files(dir))
lists <- grepl("*Brand.txt", files)
grepl("Summary", lists)
lists
lists <- grep("*Brand.txt", files, value = T)
grepl("Summary", lists)
("Summary" %in% lists)
( lists %in% "Summary")
(lists %in% "Summary")
grep("[^Summary]*Brand.txt", files, value = T)
summary <- list()
grep("[^Summary]*+Brand.txt", files, value = T)
grep("[^Summary].+Brand.txt", files, value = T)
grep("[^Summary].+", files, value = T)
grep(".+[^Summary].+Brand.txt", files, value = T)
grep(".+/[^Summary].+Brand.txt", files, value = T)
grep("[^~/GetBrandNames/Summary].+Brand.txt", files, value = T)
grep("^~/GetBrandNames/Summary.+Brand.txt", files, value = T)
lists <- grep("*Brand.txt", files, value = T)
lists <- lists[!grepl("Summary", lists)]
lists
lists <- lists[!grepl("Summary", lists)]
summary <- list()
for (list in lists){
temp_list <- as_data_frame(read.csv(list, header = T, stringsAsFactors = F))
temp_list <- temp_list %>%
select(drug = contains("drug"), brand = contains("brand")) %>%
mutate(source = list)
for(i in 1:nrow(temp_list)){
drug <- temp_list[i,"drug", drop = T]
if (nchar(temp_list[i,"brand"])){
brand <- as.data.frame(temp_list[i,"brand"])
names(brand) <- "Brand"
summary[[drug]]["Brand"] <- rbind(summary[[drug]]["Brand"],
brand
)
}
source <- as.data.frame(temp_list[i,"source"])
names(source) <- "Source"
summary[[drug]]["Source"] <- rbind(summary[[drug]]["Source"],
source
)
}
}
summary
summary <- list()
for (list in lists){
temp_list <- as_data_frame(read.csv(list, header = T, stringsAsFactors = F))
temp_list <- temp_list %>%
select(drug = contains("drug"), brand = contains("brand")) %>%
mutate(source = list)
for(i in 1:nrow(temp_list)){
drug <- temp_list[i,"drug", drop = T]
if (nchar(temp_list[i,"brand"])){
brand <- as.data.frame(temp_list[i,"brand"])
names(brand) <- "Brand"
summary[[drug]]["Brand"] <- rbind(summary[[drug]]["Brand"],
brand
)
}
}
}
summary
summary <- list()
for (list in lists){
temp_list <- as_data_frame(read.csv(list, header = T, stringsAsFactors = F))
temp_list <- temp_list %>%
select(drug = contains("drug"), brand = contains("brand")) %>%
mutate(source = list)
for(i in 1:nrow(temp_list)){
drug <- temp_list[i,"drug", drop = T]
if (nchar(temp_list[i,"brand"])){
brand <- as.data.frame(temp_list[i,"brand"])
names(brand) <- "Brand"
summary[[drug]]["Brand"] <- rbind(summary[[drug]]["Brand"],
brand
)
}else{
summary[[drug]]["Brand"] <- ""
}
}
}
summary
write(paste0("drug",",","brand_summary"), file = outfile, append = T)
for (drug in names(summary)){
uniq_brand <- unique(summary[[drug]]["Brand"])
out <- paste(drug,uniq_brand,sep = ",")
write(out, file = outfile, append = T)
}
write(paste0("drug",",","brand_summary"), file = outfile, append = T)
for (drug in names(summary)){
uniq_brand <- unique(summary[[drug]]["Brand"])
out <- paste(drug,paste(uniq_brand,collapse = ","),sep = ",")
write(out, file = outfile, append = T)
}
paste(uniq_brand,collapse = ",")
summary
date <- format(Sys.time(), "%b_%d_%Y")
outfile <- paste0("~/GetBrandNames/", "Summary_" , date , "_Brand.txt") # output filename
if (file.exists(outfile)){
file.remove(outfile)
}
write(paste0("drug",",","brand_summary"), file = outfile, append = T)
for (drug in names(summary)){
uniq_brand <- unique(summary[[drug]]["Brand"])
out <- paste(drug,paste(uniq_brand,collapse = ","),sep = ",")
write(out, file = outfile, append = T)
}
paste(uniq_brand,collapse = ",")
junk <- c("A","B")
paste(junk,collapse = ",")
date <- format(Sys.time(), "%b_%d_%Y")
outfile <- paste0("~/GetBrandNames/", "Summary_" , date , "_Brand.txt") # output filename
if (file.exists(outfile)){
file.remove(outfile)
}
if (file.exists(outfile)){
file.remove(outfile)
}
write(paste0("drug",",","brand_summary"), file = outfile, append = T)
for (drug in names(summary)){
uniq_brand <- unique(summary[[drug]]["Brand"])
out <- paste(drug,paste(uniq_brand,collapse = ","),sep = ",")
write(out, file = outfile, append = T)
}
junk <- c("A","B")
paste(junk,collapse = ",")
for (drug in names(summary)){
uniq_brand <- unique(summary[[drug]]["Brand"])
for (brand in uniq_brand){
out <- paste(drug, brand, sep = ",")
write(out, file = outfile, append = T)
}
}
date <- format(Sys.time(), "%b_%d_%Y")
outfile <- paste0("~/GetBrandNames/", "Summary_" , date , "_Brand.txt") # output filename
if (file.exists(outfile)){
file.remove(outfile)
}
write(paste0("drug",",","brand_summary"), file = outfile, append = T)
for (drug in names(summary)){
uniq_brand <- unique(summary[[drug]]["Brand"])
for (brand in uniq_brand){
out <- paste(drug, brand, sep = ",")
write(out, file = outfile, append = T)
}
}
unique(summary[[drug]]["Brand"])
for (drug in names(summary)){
uniq_brand <- unique(summary[[drug]]["Brand"])
for (brand in uniq_brand){
out <- paste(drug, brand, sep = ",")
write(out, file = outfile, append = T)
}
}
summary$methotrexate$Brand
unique(summary$methotrexate$Brand)
date <- format(Sys.time(), "%b_%d_%Y")
outfile <- paste0("~/GetBrandNames/", "Summary_" , date , "_Brand.txt") # output filename
if (file.exists(outfile)){
file.remove(outfile)
}
write(paste0("drug",",","brand_summary"), file = outfile, append = T)
for (drug in names(summary)){
uniq_brand <- unique(summary[[drug]]["Brand"])
for (brand in uniq_brand){
out <- paste(drug, brand, sep = ",")
write(out, file = outfile, append = T)
}
}
for (drug in names(summary)){
uniq_brand <- unique(summary[[drug]]["Brand"])
print(unq_brand)
for (brand in uniq_brand){
out <- paste(drug, brand, sep = ",")
write(out, file = outfile, append = T)
}
}
for (drug in names(summary)){
uniq_brand <- unique(summary[[drug]]["Brand"])
print(uniq_brand)
for (brand in uniq_brand){
out <- paste(drug, brand, sep = ",")
write(out, file = outfile, append = T)
}
}
summary[[drug]]["Brand"]
for (drug in names(summary)){
brands <- (summary[[drug]]["Brand"])
uniq <- unique(brands)
print(uniq_brand)
for (brand in uniq_brand){
out <- paste(drug, brand, sep = ",")
write(out, file = outfile, append = T)
}
}
date <- format(Sys.time(), "%b_%d_%Y")
outfile <- paste0("~/GetBrandNames/", "Summary_" , date , "_Brand.txt") # output filename
if (file.exists(outfile)){
file.remove(outfile)
}
write(paste0("drug",",","brand_summary"), file = outfile, append = T)
for (drug in names(summary)){
brands <- (summary[[drug]]["Brand"])
uniq <- unique(brands)
print(uniq_brand)
for (brand in uniq_brand){
out <- paste(drug, brand, sep = ",")
write(out, file = outfile, append = T)
}
}
for (drug in names(summary)){
brands <- summary[[drug]]["Brand"]
uniq <- unique(brands)
print(uniq_brand)
for (brand in uniq_brand){
out <- paste(drug, brand, sep = ",")
write(out, file = outfile, append = T)
}
}
for (drug in names(summary)){
brands <- summary[[drug]]["Brand"]
uniq_brand <- unique(brands)
print(uniq_brand)
for (brand in uniq_brand){
out <- paste(drug, brand, sep = ",")
write(out, file = outfile, append = T)
}
}
print(str(brands))
write(paste0("drug",",","brand_summary"), file = outfile, append = T)
for (drug in names(summary)){
brands <- summary[[drug]]["Brand"]
print(str(brands))
uniq_brand <- unique(brands)
print(uniq_brand)
for (brand in uniq_brand){
out <- paste(drug, brand, sep = ",")
write(out, file = outfile, append = T)
}
}
for (drug in names(summary)){
brands <- summary[[drug]]["Brand"]
print(str(brands))
uniq_brand <- unique(unlist(brands))
print(uniq_brand)
for (brand in uniq_brand){
out <- paste(drug, brand, sep = ",")
write(out, file = outfile, append = T)
}
}
for (drug in names(summary)){
uniq_brand <- unique(unlist(summary[[drug]]["Brand"]))
print(uniq_brand)
for (brand in uniq_brand){
out <- paste(drug, brand, sep = ",")
write(out, file = outfile, append = T)
}
}
lc(junk)
junk <- c("A","B")
lc(junk)
tolower(junk)
dir    <- "~/GetBrandNames"
files  <- paste0(dir,"/",list.files(dir))
lists <- grep("*Brand.txt", files, value = T)
lists <- lists[!grepl("Summary", lists)]
summary <- list()
for (list in lists){
temp_list <- as_data_frame(read.csv(list, header = T, stringsAsFactors = F))
temp_list <- temp_list %>%
select(drug = contains("drug"), brand = contains("brand")) %>%
mutate(source = list)
for(i in 1:nrow(temp_list)){
drug <- tolower(temp_list[i,"drug", drop = T])
if (nchar(temp_list[i,"brand"])){
brand <- as.data.frame(temp_list[i,"brand"])
names(brand) <- "Brand"
summary[[drug]]["Brand"] <- rbind(summary[[drug]]["Brand"],
brand
)
}else{
summary[[drug]]["Brand"] <- ""
}
}
}
summary
date <- format(Sys.time(), "%b_%d_%Y")
outfile <- paste0("~/GetBrandNames/", "Summary_" , date , "_Brand.txt") # output filename
if (file.exists(outfile)){
file.remove(outfile)
}
write(paste0("drug",",","brand_summary"), file = outfile, append = T)
for (drug in names(summary)){
uniq_brand <- unique(unlist(summary[[drug]]["Brand"]))
print(uniq_brand)
for (brand in uniq_brand){
out <- paste(drug, brand, sep = ",")
write(out, file = outfile, append = T)
}
}
junk <- c("A","B")
paste(junk,collapse = ",")
#!/usr/bin/env Rscript
#------
# File   : brand_by_scrapping.R
# History: 25-Jan-2019 Zhaozhi created the file
#------
# This file take the <drug list> and get the brand name from <DrugBank>
# Input  : ~/Desktop/drug.list.txt
# Output : ~/Desktop/Scraping_date.brand.txt
#------
#------
# Workflow and Argument
#------
# Step 1: get druglist
#         Line 38 to change druglist file name
# Step 2: get drugbank external links
#         Line 42~ to change drugbank username and password
# Step 3: scrapping and get brand name
# Step 4: write result to outfile
#         Line 55 to change output file name
#-------
# install and load packages
required_packages=c("tidyverse");
Install_And_Load <- function(required_packages){
remaining_packages <- required_packages[!(required_packages %in% installed.packages()[,"Package"])];
if(length(remaining_packages)){
install.packages(remaining_packages);
}
for(package in required_packages){
library(package, character.only = TRUE,quietly = TRUE);
}
}
Install_And_Load(required_packages);
dir    <- "~/GetBrandNames"
files  <- paste0(dir,"/",list.files(dir))
lists <- grep("*Brand.txt", files, value = T)
lists <- lists[!grepl("Summary", lists)]
summary <- list()
for (list in lists){
temp_list <- as_data_frame(read.csv(list, header = T, stringsAsFactors = F))
temp_list <- temp_list %>%
select(drug = contains("drug"), brand = contains("brand")) %>%
mutate(source = list)
for(i in 1:nrow(temp_list)){
drug <- tolower(temp_list[i,"drug", drop = T])
if (nchar(temp_list[i,"brand"])){
brand <- as.data.frame(temp_list[i,"brand"])
names(brand) <- "Brand"
summary[[drug]]["Brand"] <- rbind(summary[[drug]]["Brand"],
brand
)
}else{
summary[[drug]]["Brand"] <- ""
}
}
}
date <- format(Sys.time(), "%b_%d_%Y")
outfile <- paste0("~/Desktop/", "Summary_" , date , "_Brand.txt") # output filename
if (file.exists(outfile)){
file.remove(outfile)
}
write(paste0("drug",",","brand_summary"), file = outfile, append = T)
for (drug in names(summary)){
uniq_brand <- unique(unlist(summary[[drug]]["Brand"]))
print(uniq_brand)
for (brand in uniq_brand){
out <- paste(drug, brand, sep = ",")
write(out, file = outfile, append = T)
}
}
